# Pivoting

## Lab Setup
On W1, change the network e.g. add it to a 10.10.12.0/24 network
Once it is done, we bring the machines. Edit W1 and ADD a second network adapter "Custom:Virtual NAT network" (the new one we created)

On W2, we move it to the NAT network

I.e. W1 on both 10.10.10.0/24 AND 10.10.12.0/24

W2 only on 10.10.12.0/24

DC on 10.10.10.0/24


We will use psexec on metasploit

![piv-1](https://user-images.githubusercontent.com/87711310/209507872-628644d2-1f57-41eb-abb6-dddbde548c9d.png)


We get a shell. Do a `route print` (from the Windows shell) to see the network 

![piv-2](https://user-images.githubusercontent.com/87711310/209507874-0d0a8b82-2478-4364-adfd-cc508595acc0.png)

![piv-3](https://user-images.githubusercontent.com/87711310/209507863-502322b6-441e-4451-9abd-2f1e97215c38.png)

From meterpreter

```
meterpreter> run autoroute -s 10.10.12.0/24
```
![piv-4](https://user-images.githubusercontent.com/87711310/209507865-bb4d0862-fdb5-4ed2-95a8-a730cdd992cb.png)

From the IP we exploited, in 10.10.10.0/24, we try to pivot/ make a route to the 10.10.12.0/24 network

Now we can do

```
meterpreter> run autoroute -p
```
to check we have a route 

![piv-5](https://user-images.githubusercontent.com/87711310/209507867-9ba99d8b-7e40-4bf6-9adc-71f982e0cb8a.png)

Background the session

```
meterpreter> background
```

Now using a scanner on metasploit we see that we do have access to this new network (as we can scan the ports)

![piv-6](https://user-images.githubusercontent.com/87711310/209507870-3e931317-571a-41df-a05e-6220e47ffd0a.png)




