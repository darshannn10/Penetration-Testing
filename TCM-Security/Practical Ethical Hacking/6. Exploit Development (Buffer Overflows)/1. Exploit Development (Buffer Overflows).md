# Exploit Development (Buffer Overflows)

Go on Microsoft Evaluation Centre -> Download Microsoft `Windows 10 Entreprise .iso` to run on VirtualBox

We'll use it with a [VulnServer](http://www.thegreycorner.com/p/vulnserver.html) from TheGreyCorner

To download on Windows, might need to disable Microsoft Windows Defender. Once downloaded, unzip file on Desktop (or anywhere easily accessed)

Also, download [Immunity Debugger](https://www.immunityinc.com/products/debugger/) from Immunity Inc:

> It is a program debugger. Will allow us to run programs through the debugger so when we are triggering different types of exploits we can see how it is affecting the memory, the stack, so on.
> can use fake credentials to download 

## Buffer Overflows 

![kernel](https://user-images.githubusercontent.com/87711310/209446042-9c81e17d-506e-46f4-aaac-8dd8ab655633.png)

Kernel -> think of CMD line - Top
Text -> think of Read Only Code - Bottom


### Stack
![stack](https://user-images.githubusercontent.com/87711310/209446043-b6b099a3-8dea-4cef-9498-ee80e5070ebf.png)


Focus on those registers for now

ESP sitting at the TOP, EBP at the BOTTOM

Buffer space fills with characters, goes downwards

![esp](https://user-images.githubusercontent.com/87711310/209446041-b6011bab-71a5-4fe5-b8c1-0ef2519e273b.png)

If we start filling the Buffer Space, it should be able to contain the characters if it is properly sanitised.
But, if it is not, the characters will `overflow` and move to EBP and EIP!

![buff-overflow](https://user-images.githubusercontent.com/87711310/209446044-c14f8af9-188d-4867-9e9d-606b3678104b.png)
The Buffer Space does not contain our input and it overflows up to the `EIP` (pointer / return address)

We can use the `EIP` to point to a specific direction/instruction

If you can write over the buffer space and reach the EIP, you can control the stack and eventually get a reverse shell

## Steps to conduct a buffer overflow
`1. Spiking` 
- Method used to find a vulnerable part of a program

`2. Fuzzing`
- Sending a bunch of characters to the program to see if we can break it 

`3. Finding the Offset`
- If we do break it, we want to find out at what point we did break it (what location / address / which "offset")

`4. Overwritting the EIP`
- using the offset to overwrite the EIP

Once we have the EIP controlled, need to do a couple "house cleanup" things:
`5. Finding Bad Characters`
`6. Finding the right Module`

`7. Generate Shellcode`
- can generate the shellcode for the reverse shell and point the EIP to that 

`8. Gain Root`


